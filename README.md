# cs6262-project-5--machine-learning-for-security-solved
**TO GET THIS SOLUTION VISIT:** [CS6262 Project 5- Machine Learning for Security Solved](https://www.ankitcodinghub.com/product/cs6262-project-5-machine-learning-for-security-solved/)


---

üì© **If you need this solution or have special requests:** **Email:** ankitcoding@gmail.com  
üì± **WhatsApp:** +1 419 877 7882  
üìÑ **Get a quote instantly using this form:** [Ask Homework Questions](https://www.ankitcodinghub.com/services/ask-homework-questions/)

*We deliver fast, professional, and affordable academic help.*

---

<h2>Description</h2>



<div class="kk-star-ratings kksr-auto kksr-align-center kksr-valign-top" data-payload="{&quot;align&quot;:&quot;center&quot;,&quot;id&quot;:&quot;126580&quot;,&quot;slug&quot;:&quot;default&quot;,&quot;valign&quot;:&quot;top&quot;,&quot;ignore&quot;:&quot;&quot;,&quot;reference&quot;:&quot;auto&quot;,&quot;class&quot;:&quot;&quot;,&quot;count&quot;:&quot;5&quot;,&quot;legendonly&quot;:&quot;&quot;,&quot;readonly&quot;:&quot;&quot;,&quot;score&quot;:&quot;5&quot;,&quot;starsonly&quot;:&quot;&quot;,&quot;best&quot;:&quot;5&quot;,&quot;gap&quot;:&quot;4&quot;,&quot;greet&quot;:&quot;Rate this product&quot;,&quot;legend&quot;:&quot;5\/5 - (5 votes)&quot;,&quot;size&quot;:&quot;24&quot;,&quot;title&quot;:&quot;CS6262 Project 5- Machine Learning for Security Solved&quot;,&quot;width&quot;:&quot;138&quot;,&quot;_legend&quot;:&quot;{score}\/{best} - ({count} {votes})&quot;,&quot;font_factor&quot;:&quot;1.25&quot;}">

<div class="kksr-stars">

<div class="kksr-stars-inactive">
            <div class="kksr-star" data-star="1" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
            <div class="kksr-star" data-star="2" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
            <div class="kksr-star" data-star="3" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
            <div class="kksr-star" data-star="4" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
            <div class="kksr-star" data-star="5" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
    </div>

<div class="kksr-stars-active" style="width: 138px;">
            <div class="kksr-star" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
            <div class="kksr-star" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
            <div class="kksr-star" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
            <div class="kksr-star" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
            <div class="kksr-star" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
    </div>
</div>


<div class="kksr-legend" style="font-size: 19.2px;">
            5/5 - (5 votes)    </div>
    </div>
<strong>Contents&nbsp;&nbsp; <u>&nbsp;&nbsp;</u></strong>

<strong><u>&nbsp;</u></strong>

<table width="624">
<tbody>
<tr>
<td width="40"><strong>1</strong></td>
<td width="376"><strong>Goals</strong></td>
<td width="208"><strong>2</strong></td>
</tr>
<tr>
<td width="40"><strong>2</strong></td>
<td width="376"><strong>Section 1: Project quiz (5 points)</strong></td>
<td width="208"><strong>2-3</strong></td>
</tr>
<tr>
<td width="40"><strong>3</strong></td>
<td width="376"><strong>Section 2: Project setup</strong></td>
<td width="208"><strong>4</strong></td>
</tr>
<tr>
<td width="40"><strong>4</strong></td>
<td width="376"><strong>Section 3: Project tasks (95 points)</strong></td>
<td width="208"><strong>5-10</strong></td>
</tr>
<tr>
<td width="40"><strong>5</strong></td>
<td width="376"><strong>Section 4: Final deliverables and rubric</strong></td>
<td width="208"><strong>11-13</strong></td>
</tr>
<tr>
<td width="40"><strong>6</strong></td>
<td width="376"><strong>Section 5: FAQs</strong></td>
<td width="208"><strong>14-17</strong></td>
</tr>
<tr>
<td width="40"><strong>7</strong></td>
<td width="376"><strong>Section 6: Academic integrity</strong></td>
<td width="208"><strong>18</strong></td>
</tr>
</tbody>
</table>
<strong>&nbsp;</strong>

<strong>Goals of the Project</strong>

<ul>
<li>The goal of this project is to introduce students to machine learning techniques and methodologies that help to differentiate between malicious and legitimate network traffic.</li>
<li>In summary, students are introduced to:
<ul>
<li>how to build a machine-learning model based on normal network traffic.</li>
<li>how to conduct a blending attack producing artificial network traffic that resembles the normal one, and bypass the learned model.</li>
</ul>
</li>
</ul>
<strong>&nbsp;</strong>

<strong>Suggestion</strong>

We recommend that you use whatever is comfortable for you ‚Äî either local set-up or the Linux VM provided. In the past, students faced no difficulty in setting up the project and working on either Windows or Macintosh OS.

<strong>Readings and Resources</strong>

This project relies on the following readings:

&nbsp;

<ul>
<li><a href="https://cs.fit.edu/~pkc/id/related/wang05raid.pdf">‚ÄúAnomalous Payload-based Worm Detection and Signature Generation‚Äù, Ke Wang and</a> <a href="https://cs.fit.edu/~pkc/id/related/wang05raid.pdf">Salvatore J.Stolfo, RAID2004</a></li>
</ul>
The PAYL model extracts byte frequency from network packet payloads by analyzing the statistical distribution of bytes or n-grams (sequences of adjacent bytes). To train the model, normal network traffic is monitored, and the frequency of bytes or n-grams is recorded, which allows the system to learn what normal traffic looks like. The parameters include the byte (or n-gram) frequency distributions, and models are generated per packet length and port. The threshold determines how much deviation from the normal profile is acceptable before an alert is triggered. The smoothing factor is used to prevent division by zero in frequency calculations, ensuring the model can handle small variations in the data‚Äã.

&nbsp;

<ul>
<li><a href="https://www.usenix.org/legacy/events/sec06/tech/full_papers/fogla/fogla.pdf">‚ÄúPolymorphic Blending Attacks‚Äù, Prahlad Fogla, Monirul Sharif, Roberto Perdisci, Oleg Kolesnikov, Wenke Lee, Usenix Security 2006 </a></li>
</ul>
In polymorphic blending attacks (as described in section 4.2 of the ‚ÄúPolymorphic Blending Attacks‚Äù paper), to evade PAYL‚Äôs 1-gram model, attackers can substitute each byte in the malicious payload with one or more normal bytes, carefully chosen to match the byte frequency distribution of normal traffic. When m‚â§nm \leq nm‚â§n (i.e., the number of distinct characters in the attack is less than or equal to those in normal traffic), one-to-many substitution can be applied, where an attack character is mapped to several normal characters. A greedy algorithm is employed to minimize the frequency deviation, ensuring the attack payload closely resembles normal traffic, making it difficult for PAYL to detect‚Äã.

&nbsp;

<ul>
<li><a href="https://en.wikipedia.org/wiki/Sensitivity_and_specificity">‚ÄúSensitivity and specificity‚Äù</a></li>
</ul>
Summary of the topic: Sensitivity refers to the ability of a test to correctly identify individuals with a condition (true positives), while specificity measures its ability to correctly identify those without the condition (true negatives). Sensitivity focuses on detecting true positives and is important in situations where missing a diagnosis is dangerous, while specificity emphasizes minimizing false positives, crucial in preventing unnecessary treatment. Both metrics are used to evaluate the performance of diagnostic tests, with trade-offs often made between sensitivity and specificity depending on the clinical context. The balance between them can be adjusted depending on the threshold set for the test, which can prioritize either detecting more positives or reducing false alarms.

<strong>Section 1: Project Quiz (5 points)</strong>

&nbsp;

We have created a small quiz to help you understand the topics covered in this project. <strong>Please read the papers (under Readings and Resources) before attempting the quiz and the subsequent tasks</strong>.

&nbsp;

<ol>
<li>In 1-gram PAYL, the byte frequency is calculated by counting the number of occurrences of a particular byte and dividing it by the length of the payload.
<ol>
<li>True</li>
<li>False</li>
</ol>
</li>
<li>The threshold for Mahalanobis distance is used to determine if the current payload is normal or malicious. Specifically, if the Mahalanobis distance of the current payload is LESS than the threshold, the current payload is malicious and an alert is raised by PAYL.</li>
</ol>
<ol>
<li>True</li>
<li>False</li>
</ol>
<ol>
<li>Since polymorphic blending attacks try to evade network anomaly-based intrusion detection systems (IDS) by making the attacks look like normal traffic, they can be viewed as a subclass of mimicry attacks.</li>
</ol>
<ol>
<li>True</li>
<li>False</li>
</ol>
&nbsp;

<ol>
<li>In polymorphic blending attacks, the attacker uses an artificial profile which can be defined as:</li>
</ol>
<ol>
<li>The attack payload‚Äôs profile which can bypass the IDS</li>
<li>The profile of the payload generated by the polymorphic decryptor</li>
<li>The profile estimated by observing normal traffic</li>
<li>None of the above</li>
</ol>
&nbsp;

<ol>
<li>Polymorphic blending attacks use the following basic steps: (1) Blend the attack body within an instance of normal traffic payload and create an artificial payload using polymorphic encryption, (2) Let the IDS analyse this artificial payload and monitor the response received from IDS (3) Based on the response received repeat step 1 with another instance of normal traffic payload. Repeat until you find an artificial payload that can evade the IDS.</li>
</ol>
<ol>
<li>True</li>
<li>False</li>
</ol>
&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

<strong>1.1: Deliverables</strong>

<strong>&nbsp;</strong>

For each question,&nbsp; please enter your option in <strong>answers.txt</strong> as shown in the sample file below.&nbsp; You will deliver <strong>answers.txt</strong> for this part.

&nbsp;

You can find <strong>answers.txt</strong> under the project directory.

<strong>NOTE: </strong><strong>You may not see the marks you obtained for the quiz (and hence, the total marks of the project) to avoid students from brute-forcing the answers.</strong>

<strong><u>&nbsp;</u></strong>

<strong><u>&nbsp;</u></strong>

<strong><u>&nbsp;</u></strong>

<strong><u>&nbsp;</u></strong>

<strong><u>&nbsp;</u></strong>

<strong><u>&nbsp;</u></strong>

<strong><u>&nbsp;</u></strong>

<strong><u>&nbsp;</u></strong>

<strong><u>&nbsp;</u></strong>

<strong><u>&nbsp;</u></strong>

<strong><u>&nbsp;</u></strong>

<strong><u>&nbsp;</u></strong>

<strong><u>&nbsp;</u></strong>

<strong><u>&nbsp;</u></strong>

<strong><u>&nbsp;</u></strong>

<strong><u>&nbsp;</u></strong>

<h2><strong>Section 2: Project Setup</strong></h2>
&nbsp;

You can either use the provided VM to complete the project&nbsp; <strong>OR</strong>&nbsp; you can set up your own environment locally.

<strong>2.1: VM Setup </strong>

1. Download the VM using one of the links provided in the project description on canvas. (The password for the VM is cs6262).

2. All the required packages/dependencies are already installed in the VM. The project files are under:

<strong>Desktop -&gt; project 5

HOWEVER: please use project5.zip in Canvas for the most updated version.</strong>

<strong>2.2: Local Setup</strong>

1. Download the project zip file from the link provided in the project description on Canvas.

<ol start="2">
<li>Please refer SETUP.txt in the PAYL directory to install the dependencies, using the same versions specified in the SETUP.txt.</li>
</ol>
&nbsp;

The local setup is tested on Ubuntu 18.04 and Ubuntu 20.04. Please use Ubuntu 18.04 if possible.

&nbsp;

<strong>TIP: </strong>Even if you are using the provided VM, please check <strong>SETUP.txt</strong> to understand how the project is set up and to get an overview of the various code components in the project. This might help in debugging any issues you might face later.

<strong><u>&nbsp;</u></strong>

<strong><u>&nbsp;</u></strong>

<strong><u>&nbsp;</u></strong>

<strong><u>&nbsp;</u></strong>

<strong><u>&nbsp;</u></strong>

<h2><strong>Section 3: Project Tasks (95 points)</strong></h2>
<strong>&nbsp;</strong>

<strong>3.1: Task A ‚Äì Training an ML model to detect normal traffic (17.5 points)</strong>

<h3><strong>3.1.1: Preliminary Reading</strong></h3>
Please refer to the reference readings to learn about how PAYL model works, in particular,

<ol>
<li>how to extract byte frequency from the data</li>
<li>how to train the model</li>
<li>the definitions of parameters, threshold and smoothing factor</li>
</ol>
&nbsp;

&nbsp;

<h4><strong>3.1.2: Code and data provided</strong></h4>
The<strong> PAYL directory</strong> provides the PAYL code and data for model training.

&nbsp;

<strong>3.1.3: PAYL Code Workflow</strong>

Here is the workflow of the provided PAYL code:

&nbsp;

<ul>
<li>Operates in 2 modes:</li>
</ul>
<ol>
<li>training mode: It reads pcap files provided in the ‚Äòdata‚Äô directory, and tests parameters and reports the True Positive rates.</li>
<li>testing mode: It first builds a model using parameters and data specified in the directory. Then it will test a specific packet and decide whether the test packet fits the model.</li>
</ol>
<ul>
<li>Training mode
<ul>
<li>Read the normal traffic data and divide it into two parts, 75% of the data for training and the rest 25% for testing (NOTE: <strong>You will NOT change these portions in the code</strong>).</li>
<li>Sort the payload strings by length and generate a model for each length.</li>
<li>Each model per length is based on<em> [mean frequency of each ascii, standard deviation of frequencies for each ascii]. </em></li>
</ul>
</li>
</ul>
<em>&nbsp;</em>

<strong>To run PAYL in training mode</strong>

<table>
<tbody>
<tr>
<td width="624">$ python3 wrapper.py</td>
</tr>
</tbody>
</table>
&nbsp;

<strong>Testing mode</strong>

&nbsp;

<ul>
<li>Read the normal traffic data from the directory, and train a model using specific parameters. Then test the specific packet (fed from the command line) using the trained model.</li>
<li>Compute the Mahalanobis distance between each test payload and the model (of the same length)</li>
<li>Label the payload: If the Mahalanobis distance is below the specified threshold, label the payload as normal traffic. Otherwise, label the packet as attack traffic.</li>
</ul>
&nbsp;

<strong>To run PAYL in testing mode</strong>

<table>
<tbody>
<tr>
<td width="624">$ python3 wrapper.py [FILE.pcap]</td>
</tr>
</tbody>
</table>
&nbsp;

where FILE.pcap is the data you will test.

<strong>&nbsp;</strong>

<strong>&nbsp;</strong>

<strong>3.1.4: Tasks ‚Äì Conduct experiments to select parameters</strong>

&nbsp;

<ul>
<li>You are provided with artificial payloads (normal network traffic) to train a PAYL model.</li>
<li>After reading the reference papers, it should make sense that you cannot train the PAYL model on the entire traffic of different protocols. So first you need to <strong>select a protocol: a) HTTP or b) DNS by changing the hard-coded option in </strong><strong>py.</strong></li>
<li>The next step is to select a proper pair of parameters for the model. For the selection process, you will provide a range for both parameters (by modifying the threshold and smoothing factor in wrapper.py). Then run wrapper.py on training mode and make sure the normal traffic (artificial payloads stored in the default data folder) is fed while training.</li>
<li>The code will output the statistics for the parameters in the range. As shown in the figure below, for each pair of parameters, you will observe a True Positive Rate. <strong>You need to report a pair of parameters <u>(mSF and mTmd)</u> output by the code that achieves True Positive rate of <u>96%</u> or more (and this True Positive rate should be reported as well).</strong> More than 99% true positive rate is possible and you may find multiple pairs of parameters that can achieve that.</li>
</ul>
&nbsp;

<table>
<tbody>
<tr>
<td width="49"></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
The figure shows a sample output from the wrapper.py. You will find mSF and mTMD values which make mTP&gt;96% for both HTTP and DNS protocols respectively. The parameters can be different for the two protocols.

&nbsp;

<strong>3.1.5: Deliverables</strong>

Please report for each protocol that you used, the parameters that you found (output by wrapper.py) in a file named <strong>parameters.txt</strong>. Please report a decimal <strong>with rounded 2-digit accuracy</strong> for each parameter.

&nbsp;

<strong>NOTE:</strong> You are given a sample&nbsp; <strong>parameters.txt </strong>with dummy values in the <strong>PAYL directory</strong>. Please update the relevant values with your own answer. Check section 4 for more details.

<strong>NOTE:</strong> The value for ‚Äú<strong>DISTANCE</strong>‚Äù in <strong>parameters.txt</strong> will be obtained in the next task (section 3.2).

&nbsp;

<strong>TIP: </strong>You can set lower and upper bound values of both parameters in wrapper.py as the values you found in training mode to avoid multiple iterations during the testing mode.

<strong>&nbsp;</strong>

<strong>3.2: Task B ‚Äì Evaluating packets on the ML model (17.5 points)</strong>

&nbsp;

<strong>Download your unique attack payload [YOUR_GTUSERNAME.pcap] from Files in Canvas, and place it in the PAYL directory of the Project 5 folder.</strong>

<strong>(Path: Files -&gt; Projects -&gt; Project Five -&gt;</strong><a href="https://gatech.instructure.com/courses/404728/files/folder/Projects/Project%20Five/student_pcaps2024Fall"><strong>student_pcaps2024Fall</strong></a><strong>)</strong>

<strong>Link: </strong><a href="https://gatech.instructure.com/courses/404728/files/folder/Projects/Project%20Five/student_pcaps2024Fall"><strong>https://gatech.instructure.com/courses/404728/files/folder/Projects/Project%20Five/student_pcaps2024Fall</strong></a>

<strong>&nbsp;</strong>

<strong>&nbsp;</strong>

&nbsp;

For this part, you will create attack data that can evade the ML model you trained in Task A. You will ensure that the attack data does not fit the model, while the normal network traffic fits. Make sure you have completed Task A and that the <strong>parameters.txt</strong> file is set. Completing Task A and Task B will be essential to demonstrating the polymorphic blending attack in Task C.

&nbsp;

<h4><strong>Use PAYL in testing mode</strong></h4>
<ul>
<li>You will first change <strong>py</strong> to use the parameters recorded in <strong>parameters.txt</strong>. Open <strong>wrapper.py</strong> and change the <strong>None </strong>values of the following parameters:</li>
</ul>
&nbsp;

http_smoothing_factor = None

dns_smoothing_factor = None

http_threshold_for_mahalanobis = None

dns_threshold_for_mahalanobis = None

&nbsp;

<ul>
<li>For BOTH the DNS protocol and the HTTP protocol, verify that your attack payload gets <strong>rejected</strong>. By ‚Äúrejected‚Äù, we mean that you will get a ‚Äú<strong>It doesn‚Äôt fit the model</strong>‚Äù message on your test screen as seen in the following figure, which indicates that your attack sample has been detected as anomalous.</li>
</ul>
&nbsp;

$ python wrapper.py &lt;YOUR GT ID&gt;.pcap

<table>
<tbody>
<tr>
<td width="11"></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li>Now verify the artificial payloads (normal traffic). We provide two artificial payloads; one for HTTP (pcap) and one for DNS (dns_artificial_profile.pcap). Both are in the PAYL folder. Test each artificial payload against your model.</li>
</ul>
&nbsp;

(set the training_protocol parameter in wrapper.py)

$ python wrapper.py http_artificial_profile.pcap

&nbsp;

(set the training_protocol parameter in wrapper.py)

$ python wrapper.py dns_artificial_profile.pcap

&nbsp;

<ul>
<li>(NOTE: DO NOT forget to change parameters according to each protocol while testing relevant payload, e.g., DNS parameters to test dns_artificial_profile.pcap.) These should be <strong>accepted</strong> by the model. That is, you should get an output message that says ‚Äú<strong>It fits the model</strong>‚Äù as presented in the following figure, which indicates that the sample is not detected as anomalous. The output will show your own parameters, not ‚ÄúmSF‚Äù , ‚ÄúmTMD‚Äù, or ‚ÄúmTP‚Äù.</li>
</ul>
&nbsp;

&nbsp;

<table>
<tbody>
<tr>
<td width="49"></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
&nbsp;

<strong>3.2.1: Deliverables</strong>

Please report your calculated distance (where mDISTANCE is in the above figures) in <strong>parameters.txt </strong>for each protocol with the values of the <strong>attack payload</strong> <strong>(YOUR_GTUSERNAME.pcap) </strong>after completing Task B.

&nbsp;

&nbsp;

<strong>&nbsp;</strong>

<strong>3.3: Task C ‚Äì Crafting a packet to evade the ML model (60 points) </strong>

&nbsp;

We assume that the attacker has a specific payload (attack payload) that she would like to blend in with the normal traffic. Also, we assume that the attacker has access to one packet (artificial profile payload) that is normal and is accepted as normal by the PAYL model.

&nbsp;

<em>Preliminary reading: Please refer to the ‚ÄúPolymorphic Blending Attacks‚Äù paper. In particular, section 4.2 describes how to evade 1-gram and the model implementation. More specifically we are focusing on the case where m &lt;= n and the </em><em>substitution is ONE-TO-MANY. </em>

&nbsp;

The attacker‚Äôs goal is to transform the byte frequency of the attack traffic so that it matches the byte frequency of the normal traffic, and thus bypass the PAYL model.

NOTE: Complete this task ONLY for the HTTP protocol.

&nbsp;

Code provided: Please look at the <strong>Polymorphic_blend directory</strong>. All files (including attack payload) for this task should be in this directory. Hence, copy your unique attack payload also in this directory. <u>Rename </u><u>ATTACKBODY_PATH</u><u> in</u><u> task1.py </u><u>with your unique attack payload name (</u><u>YOUR_GTUSERNAME.pcap</u><u>).</u>

&nbsp;

<strong>How to run the code</strong>

<table>
<tbody>
<tr>
<td width="624">$ python3 task1.py</td>
</tr>
</tbody>
</table>
&nbsp;

NOTE: You need to complete Task C before running task1.py.

&nbsp;

<strong>Main function </strong>

<strong>task1.py </strong>contains all the functions that are called to transform the byte frequency of the attack traffic.

&nbsp;

<strong>Output</strong>

<ul>
<li>The code should generate a new payload (filename: <strong>output</strong>) that can successfully bypass the PAYL model that you have found above (using your selected parameters in Task A and B).</li>
<li>The new payload (<strong>output</strong>) is bin + encrypted attack body + XOR table + padding. <strong>Please refer to the paper for full descriptions and definitions of shellcode, attack body, XOR table and padding. </strong></li>
<li>The shellcode is provided.</li>
</ul>
&nbsp;

<strong>Substitution table</strong>

We provide the skeleton for the code needed to generate a substitution table, based on the byte frequency of attack payload and artificial profile payload. For the purpose of implementation, the substitution table can be e.g. a python dictionary table. We ask that you complete the code for the substitution function. The substitution is one-to-many. Skeleton code prints the substitution table to the console. You will deliver your substitution table in <strong>substitution_table.txt</strong> file in the following format.

NOTE: This is just an example to show the format of the table. Please ignore the frequency values.

NOTE: The substitution table should have the frequencies as observed in the normal payload. Please do <strong>NOT</strong> normalize these values in <strong>substitution_table.txt. </strong>You can normalize the values later during substitution in <strong>substitution.py.</strong>

<strong>&nbsp;</strong>

<strong>More information on the substitution table</strong>

The table is used during the substitution process to map the most frequent characters in the attack payload to characters in the artificial payload in a probabilistic manner. Characters with higher frequencies are more likely to be chosen as substitutes. This makes it possible to disguise the attack payload by using characters and frequency distributions from a benign payload (the artificial one), potentially making the attack harder to detect or analyze.

&nbsp;

The sample substitution table represents mappings between characters in an attack payload and characters from an artificial payload based on their frequency. Here‚Äôs a breakdown of how to interpret it:

<ol>
<li>Keys: The keys in the dictionary represent the characters from the attack payload.</li>
<li>Values: The values are lists of tuples. Each tuple contains:</li>
</ol>
<ul>
<li>A character from the artificial payload that could be substituted for the attack payload character.</li>
<li>A number representing the frequency (or weight) of this character from the artificial payload.</li>
</ul>
&nbsp;

&nbsp;

<strong>Padding</strong>

Similarly, we have provided a skeleton for the padding function and we are asking you to complete the rest.

&nbsp;

<strong>Main tasks</strong>

Please complete the code for the<strong> substitution.py</strong> and <strong>padding.py</strong> and then run <strong>task1.py</strong> to generate the new payload (<strong>output</strong>).

<strong>3.3.1: Deliverables</strong>

<ul>
<li>You will deliver <strong>py</strong>, <strong>padding.py</strong>, your new payload (<strong>output</strong>) and <strong>substitution_table.txt</strong> for this task.</li>
<li>You‚Äôre expected to <strong>write comments</strong> for your code. Otherwise, <strong>you will lose 5 points.</strong></li>
</ul>
&nbsp;

<strong>Test your output</strong>

Test your new payload (output) against the PAYL model and <strong>verify that it is accepted</strong>. FP should be 100% indicating that the payload got accepted as legit, even though it is malicious. You should run as follows and observe the following output, and get the output message that says, ‚Äú<strong>It fits the model</strong>‚Äù.

<table>
<tbody>
<tr>
<td width="1"></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<strong>TIP:</strong> Check the relevant FAQs in section 5.

&nbsp;

<strong>IMPORTANT:</strong> <strong>Please check section 5.6 to understand how you can verify your code.</strong>

&nbsp;

<h2><strong>Section 4: Final deliverables and Rubric</strong></h2>
<table width="459">
<tbody>
<tr>
<td width="109"><strong>Tasks </strong></td>
<td width="350"><strong>Deliverable Files </strong></td>
</tr>
<tr>
<td width="109">Project Quiz</td>
<td width="350"><strong>answers.txt </strong></td>
</tr>
<tr>
<td width="109">A &amp; B</td>
<td width="350"><strong>parameters.txt </strong></td>
</tr>
<tr>
<td width="109">C</td>
<td width="350"><strong>substitution.py </strong>

<strong>padding.py </strong>

<strong>substitution_table.txt </strong>

<strong>output </strong>
</td>
</tr>
</tbody>
</table>
<strong>Total: </strong><strong>6 </strong><strong>files</strong>

<strong>Total points:</strong><strong> 100</strong>

<strong>Please make sure to submit all of the files to Gradescope</strong><strong>. </strong><strong>Do NOT ZIP your deliverable files.</strong>

<strong><u>4.1: Project Quiz ‚Äì 5 points</u></strong>

<strong><u>4.2: Task A ‚Äì&nbsp; 17.5 points</u></strong>

Please report (for each protocol) the parameters that you found in a file named<strong> parameters.txt</strong>. <strong>Please report a decimal with 2 digit accuracy for each parameter</strong>.

<strong><u>4.3: Task B ‚Äì 17.5 points</u></strong>

Please report your calculated distance (mDISTANCE in the above figures) in <strong>parameters.txt</strong> for each protocol with the values of the attack payload after completing Task B.

&nbsp;

<strong>parameters.txt</strong> format:

<table>
<tbody>
<tr>
<td width="624"><strong>|</strong><strong>Protocol:HTTP</strong><strong>|</strong><strong>

</strong><strong>|</strong><strong>Threshold:1111.00</strong><strong>|</strong><strong>

</strong><strong>|</strong><strong>SmoothingFactor:0.01</strong><strong>|</strong><strong>

</strong><strong>|</strong><strong>TruePositiveRate:50.00</strong><strong>|</strong><strong>

</strong><strong>|</strong><strong>Distance:2000.00</strong><strong>|</strong><strong>

</strong><strong>|</strong><strong>Protocol:DNS</strong><strong>|</strong><strong>

</strong><strong>|</strong><strong>Threshold:2222.00</strong><strong>|</strong><strong>

</strong><strong>|</strong><strong>SmoothingFactor:0.00</strong><strong>|</strong><strong>

</strong><strong>|</strong><strong>TruePositiveRate:50.00</strong><strong>|</strong><strong>

</strong><strong>|</strong><strong>Distance:2000.00</strong><strong>|</strong><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </strong></td>
</tr>
</tbody>
</table>
&nbsp;

<strong>NOTE:</strong> You are given a sample&nbsp; <strong>parameters.txt</strong> with<strong> dummy values</strong> under PAYL directory. Please update each value with your own answer. <strong>Those values should only come from the PAYL script‚Äôs output to the console. (not from the values modified inside the script).</strong>

<strong>Description of fields in parameters.txt</strong>

<strong><em>|Protocol:HTTP|

|Threshold:1111.00|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Part A

|SmoothingFactor 0.01|&nbsp;&nbsp; // Part A

|TruePositiveRate:50.00| // Part A

|Distance:20020.00|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Part B, mDISTANCE this is the mDISTANCE value that you get from your unique pcap file (python wrapper.py &lt;yourunique.pcap&gt;)

|Protocol:DNS|

|Threshold:2222.00|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Part A

|SmoothingFactor:0.00|&nbsp;&nbsp; // Part A

|TruePositiveRate:50.00| // Part A

|Distance:22000.00|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Part B, mDISTANCE this is the mDISTANCE value that you get from your unique pcap file (python wrapper.py &lt;yourunique.pcap&gt;)</em></strong>

&nbsp;

NOTE: <strong>‚Äú0.3‚Äù should be entered as ‚Äú0.30‚Äù. ‚Äú2‚Äù should be entered as ‚Äú2.00‚Äù.</strong>

<strong><u>4.4: Task C ‚Äì&nbsp; 60 points</u></strong>

Please submit the following files:<strong> substitution.py</strong>,and <strong>padding.py</strong>, and your<strong> substitution_table.txt</strong>, and the <strong>output</strong> of Task C (generated as a new file after running task1.py). This output is <strong><u>very</u></strong> <strong><u>important</u></strong> and represents a significant portion of the points for Task C.

&nbsp;

&nbsp;

<strong><u>4.5: !! Important Notes&nbsp;&nbsp; (Please check before submission) !! </u></strong><strong>&nbsp;&nbsp;&nbsp;</strong>

<ul>
<li>Every file name with the wrong name and/or extension will be penalized with 5 points.</li>
<li><strong>Do NOT ZIP your deliverable files. You will lose 5 points for zipped files. </strong></li>
<li>Follow the format for substitution_table.txt above (section 3.3), for the wrong format you will lose 5 points.</li>
<li>Follow the format for parameters.txt above, for the wrong format you will lose 5 points.</li>
<li>Do not forget to update your parameters.txt If you submit sample parameters.txt with dummy values, you will get 0/35 for Task A and B. We won‚Äôt accept resubmission after the due date.</li>
<li><strong>You should complete Task A, B and C with the same set of parameters. If your output doesn‚Äôt pass the model with parameters in your parameters.txt you will get 0/20 for output. </strong></li>
<li>For Task B, in parameters.txt you will report calculated distance after you provide your own attack payload. (i.e.YOUR_GTUSERNAME.pcap)</li>
</ul>
&nbsp;

<ul>
<li>For Task C, You are allowed to import and use ‚Äúrandom‚Äù or ‚Äúnumpy‚Äù. Do NOT import any other libraries.</li>
<li><strong>If you don‚Äôt implement the correct algorithm for Task C, even if your output passes the model you won‚Äôt get full credit. We will not accept the implementation of ONE-ONE mapping</strong>. (Check section 5.2)</li>
<li>Don‚Äôt forget to put comments for your code. Otherwise, you will lose 5 points.</li>
</ul>
<h3></h3>
&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

<strong><u>&nbsp;</u></strong>

<h2><strong>Section 5: FAQs</strong></h2>
<strong><u>5.1: Task C clarifications</u></strong>

<ul>
<li>As we saw in part A+B, your unique attack payload does not fit the model. In Task C we want to make our pcap fit.</li>
<li>We care about our attack payload being turned into what a normal payload would look like.</li>
<li>We‚Äôre simply performing substitution and padding to match the character frequency and packet size.</li>
<li>We want to modify the various python functions to perform this substitution and padding for us.</li>
<li>After the functions have been crafted, copy the file it generates (output) over to your PAYL directory and test it (python3 wrapper.py output). You want it to fit the model.</li>
</ul>
&nbsp;

<h4><strong>&nbsp;</strong></h4>
<strong><u>5.2: How to implement Substitution Table &amp; Substitute? </u></strong>

First Refer to the ‚ÄúPolymorphic Blending Attacks‚Äù paper. In particular, section 4.2 describes how to evade 1-gram and the model implementation. More specifically we are focusing on the case where m &lt;= n and the substitution is ONE-TO-MANY.

&nbsp;

<strong>NOTE:</strong><strong> We will not accept the implementation of ONE-ONE mapping</strong>.

&nbsp;

Refer to the example provided in the write-up (section 5.5).

&nbsp;

After reading the paper and example, it should be obvious how to implement a substitution table. If you still have any specific questions you can post your questions on Ed discussion.

&nbsp;

<strong>Substitution</strong>

Given an attack byte, find the mapping in your Substitution Table. You will have multiple choices because of how we constructed the table. Pick one based on the ratio of the bytes frequency to the sum of all frequencies. You have to normalize the frequencies to sum up to 1.

&nbsp;

NOTE: You are allowed to import and use ‚Äúrandom or numpy‚Äù for this task. Do NOT import any other libraries.

&nbsp;

&nbsp;

<strong><u>5.3: How to implement Padding?</u></strong>

Find the byte with the largest byte frequency difference, say ‚Äòa‚Äô, and append ‚Äòa‚Äô to the raw_payload (padding.py). Padding function is called repeatedly when

len(raw_payload) &lt; len(artificial_payload) (as in task1.py).

So each time you only need to pad one byte when the padding function is called.

<strong><u>&nbsp;</u></strong>

<strong><u>5.4: XOR and result Clarification in Task C</u></strong>

Both are lists of characters, where ‚Äòresult‚Äô keeps the replacement chars and ‚Äòxor‚Äô keeps the XOR of replacement and corresponding attack value.

&nbsp;

From the sample in the write-up. Assume ‚Äòt‚Äô is replaced by ‚ÄòZ‚Äô then your result will include ‚ÄòZ‚Äô and xor table will include XOR(‚Äòt‚Äô,‚ÄôZ‚Äô)=‚Äô.‚Äô

&nbsp;

<strong>NOTE:</strong> Be careful while XORing the chars

<strong>NOTE</strong><strong>:</strong> You substitution_table.txt should have the format we mentioned in the writeup.

<strong>NOTE:</strong> You need to verify your Task C and see your original packet content. (check section 5.6)

&nbsp;

&nbsp;

<strong><u>5.5: Simple example for substitution</u></strong>

<strong>Please refer to the ‚ÄòPolymorphic Blending Attack‚Äô: Substitution part</strong>

&nbsp;

Example

# normal traffic <strong>(x)</strong> and attack traffic <strong>(y</strong>):

<strong>x = abbcccdddd,</strong>

<strong>y = rrsss </strong>

&nbsp;

# distinct characters in normal traffic <strong>(n)</strong> and attack body <strong>(m)</strong>:

<strong>n = 4, </strong>

<strong>m = 2 </strong>

&nbsp;

# frequency of characters in normal traffic <strong>f(x)</strong> and attack body <strong>g(y)</strong>:

<strong>f(x) = [(‚Äòd‚Äô, 0.4), (‚Äòc‚Äô, 0.3), (‚Äòb‚Äô, 0.2), (‚Äòa‚Äô, 0.1)] ,</strong>

<strong>g(y) = [(‚Äòs‚Äô, 0.6), (‚Äòr‚Äô, 0.4)] </strong>

&nbsp;

For the first m characters in <strong>(x)</strong>, create a one-to-one mapping in both sets:

<strong>Let : t^f(y_j) = f(x_i)</strong>, where t^f(y_j) refers to ‚Äút \times \hat{f}(y_j)‚Äù in LaTeX notation (the carrot does NOT refer to exponentiation/power).

<strong>Then:</strong>

<strong>S(s) = [(‚Äòd‚Äô, 0.4)]</strong>

<strong>S(r) = [(‚Äòc‚Äô, 0.3)] </strong>

<strong>t^f(s) = 0.4 </strong>

<strong>t^f(r) = 0.3 </strong>

&nbsp;

For the (m+1)th char, first find the attack character with max ratio of <strong>g(y_j)/t^f(y_j)</strong>:

<strong>g(s)/(t^f(s)) = 0.6/0.4 = 1.5 </strong>

<strong>g(r)/(t^f(r)) = 0.4/0.3 = 1.33 </strong>

&nbsp;

So, the next attack character is <strong>‚Äòs‚Äô</strong>.&nbsp; Then, your substitution table at this step is:

<strong>S(s)= [(‚Äòd‚Äô, 0.4), (‚Äòb‚Äô,0.2)] </strong>

<strong>S(r)= [(‚Äòc‚Äô, 0.3)</strong>]

&nbsp;

&nbsp;

and update:

<strong>t^f(s)=0.4+0.2=0.6 </strong>

Repeat to find the next attack character and so on.

<strong>g(s) / (t^f(s)) = 0.6/0.6 = 1 </strong>

<strong>g(r) / (t^f(r)) = 0.4/0.3 = 1.33</strong>

&nbsp;

Now, the next attack character is <strong>‚Äòr‚Äô</strong>. Then, your substitution table at this step is

<strong>S(s)= [(‚Äòd‚Äô, 0.4), (‚Äòb‚Äô,0.2)] </strong>

<strong>S(r)= [(‚Äòc‚Äô, 0.3), (‚Äòa‚Äô,0.1)] </strong>

and update:

<strong>t^f(r) = 0.3 + 0.1 = 0.4</strong>

&nbsp;

After you finish the substitution, you are done with <strong>t^f(y_j)‚Äôs</strong> and you will make a substitution with the frequency weight of each character in the table.

&nbsp;

s is substituted with:

<strong>d with a probability of 0.4/(0.4+0.2)</strong>

<strong>b with a probability of 0.2/(0.4+0.2) </strong>

&nbsp;

r is substituted with:

<strong>c with a probability of&nbsp; 0.3/(0.3+0.1) </strong>

<strong>a with a probability of 0.1/(0.3+0.1) </strong>

&nbsp;

It is up to you how you implement a weighted random assignment, but it is a trivial step.

&nbsp;

&nbsp;

<strong><u>5.6 How to verify Task C? </u></strong>

If you only have 64-bit compiler, you need to run the following:

&nbsp;

<table>
<tbody>
<tr>
<td width="624">$ sudo apt-get install lib32gcc-4.9-dev

$ sudo apt-get install gcc-multilib
</td>
</tr>
</tbody>
</table>
&nbsp;

<strong>NOTE: </strong>You can also verify Task C using lib32gcc-9-dev.

&nbsp;

If you‚Äôre on Ubuntu Xenial, the one listed in the instructions should work: lib32gcc-4.9-dev

If you‚Äôre on Debian Buster or Ubuntu Bionic, try: lib32gcc-8-dev

If you‚Äôre on Ubuntu Cosmic or Disco, try: lib32gcc-9-dev

&nbsp;

The 32 bit compiler is already installed in the VM.

&nbsp;

Next, you need to generate your payload. So, somewhere near the end of task1.py add the following to create your payload.bin:

&nbsp;

&nbsp;

&nbsp;

payload_file:

<table>
<tbody>
<tr>
<td width="624">payload_file.write(bytearray(‚Äú‚Äù.join(adjusted_attack_body + xor_table), ‚Äúutf8‚Äù))</td>
</tr>
</tbody>
</table>
&nbsp;

&nbsp;

Now, run task1.py to generate <strong>payload.bin</strong> and once it‚Äôs generated, run the makefile with<strong> make</strong> and then run<strong> a.out</strong>:

&nbsp;

<table>
<tbody>
<tr>
<td width="624">$ make

$ ./a.out</td>
</tr>
</tbody>
</table>
&nbsp;

<strong>If all is well, you should see your original packet contents. If not you will get a bunch of funny letters. </strong>

&nbsp;

<strong>NOTE:</strong> This project has only been only tested on Linux, so you may need to make a few modifications according to your system configuration.

&nbsp;

&nbsp;

&nbsp;

<h2><strong>Section 6: Academic Integrity </strong></h2>
&nbsp;

<ul>
<li>All submitted code must be written by you.</li>
<li>Borrowing or adapting code from other students and websites like StackOverflow, ChatGPT, code repositories, and other sources is strictly forbidden.</li>
<li>You may not discuss specific solutions. Keep your discussions at a high level.</li>
<li>Sharing code is strictly forbidden.</li>
<li>Note that we will report you to the Office of Student Integrity if there is a violation.</li>
<li>As a reminder, please review the Georgia Tech Honor Code and the course policies outlined in the syllabus.</li>
</ul>
&nbsp;

&nbsp;

<strong>Good luck and have fun!! </strong>

&nbsp;

&nbsp;

&nbsp;

&nbsp;
